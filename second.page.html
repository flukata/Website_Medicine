<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediScan • ใช้งาน</title>
  <meta name="description" content="หน้าใช้งาน MediScan: ป้อนคำถามด้วยข้อความหรืออัปโหลดรูป PNG/JPG แล้วแสดงผลเป็นข้อความ" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{ --bg:#0b1220; --card:#101828; --muted:#96a2b4; --text:#e6edf3; --brand:#0ea5e9; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.25) }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{ margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; color:var(--text); background:radial-gradient(1200px 1000px at 80% -10%, rgba(14,165,233,.15), transparent), linear-gradient(180deg, #0B1220 0%, #0B1425 100%) }
    a{ color:var(--brand); text-decoration:none }
    .container{ width:min(1120px, 92%); margin-inline:auto }
    header{ padding:1rem 0 0 }
    .nav{ display:flex; align-items:center; justify-content:space-between; gap:1rem }
    .logo{ display:flex; align-items:center; gap:.6rem; font-weight:800; letter-spacing:.3px }
    .menu a{ padding:.6rem .8rem; border-radius:10px }
    .menu a:hover{ background:rgba(255,255,255,.05) }

    main{ padding:1.2rem 0 2.2rem }
    h1{ font-size: clamp(1.4rem, 4vw, 2rem); margin:.2rem 0 .4rem }
    .muted{ color:var(--muted) }

    .grid{ display:grid; gap:1rem; grid-template-columns: 1fr 1fr }
    @media (max-width:960px){ .grid{ grid-template-columns: 1fr } }

    .card{ background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); padding:1rem; border-radius:var(--radius); box-shadow:var(--shadow) }
    .card h2{ margin:.2rem 0 .4rem }

    label{ display:grid; gap:.4rem; font-weight:700 }
    textarea{ border:1px solid rgba(255,255,255,.12); background:#0f172a; color:var(--text); padding:.8rem .9rem; border-radius:12px; outline:none; min-height:140px }
    textarea:focus{ border-color:var(--brand); box-shadow:0 0 0 4px rgba(14,165,233,.15) }

    .row{ display:flex; gap:.6rem; flex-wrap:wrap }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.8rem 1rem; border-radius:12px; font-weight:800; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.1); background:#0f172a; color:var(--text) }
    .btn.primary{ background:var(--brand); color:#06202a; border-color:transparent }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }

    .drop{ border:2px dashed rgba(255,255,255,.2); border-radius:14px; padding:1rem; background:rgba(15,23,42,.6) }
    .drop.drag{ border-color: var(--brand); background: rgba(14,165,233,.08) }
    .hint{ font-size:.95rem; color:#b7c2d3 }

    .status{ min-height:1.2rem; color:var(--muted) }

    /* ผลลัพธ์แบบข้อความเท่านั้น */
    #result[hidden]{ display:none }
    #result{ margin-top:1rem }
    .result-wrap{ background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden }
    .result-head{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; padding: .9rem 1rem; background: rgba(14,165,233,.08); border-bottom:1px solid rgba(14,165,233,.25) }
    .result-body{ padding: 1rem }
    .result-text{ white-space: pre-wrap; line-height: 1.75 }

    /* โหลด */
    .loading{ display:inline-flex; align-items:center; gap:.6rem }
    .spinner{ width:18px; height:18px; border:3px solid rgba(255,255,255,.25); border-top-color: var(--brand); border-radius:50%; animation:spin 1s linear infinite }
    @keyframes spin{ to { transform: rotate(360deg) } }
  </style>
</head>
<body>
  <header class="container">
    <nav class="nav">
      <div class="logo">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#0ea5e9" stroke-width="2" fill="none"/></svg>
        MediScan
      </div>
      <div class="menu">
        <a href="first.page.html">หน้าหลัก</a>
      </div>
    </nav>
  </header>

  <main class="container" id="main" tabindex="-1">
    <h1>ใช้งานระบบ</h1>
    <p class="muted">ป้อนคำถามด้วยข้อความหรืออัปโหลดรูปภาพ (PNG/JPG) จากนั้นกด "ประมวลผล" — ผลลัพธ์จะแสดงเป็น<strong>ข้อมูลยา</strong></p>

    <section class="grid" aria-label="อินพุต">
      <!-- ช่องอัปโหลดรูป -->
      <article class="card">
        <h2>อัปโหลดรูปฉลากยา</h2>
        <div id="drop" class="drop" role="group" aria-label="อัปโหลดรูป">
          <p class="muted">วางไฟล์ที่นี่ หรือ</p>
          <div class="row">
            <input id="file" type="file" accept="image/png,image/jpeg" aria-label="เลือกไฟล์รูป PNG หรือ JPG" />
            <button class="btn" id="clearFile" type="button">ล้างไฟล์</button>
          </div>
          <p class="hint" id="fileHint">ยังไม่ได้เลือกไฟล์</p>
        </div>
      </article>

      <!-- ช่องข้อความ -->
      <article class="card">
        <h2>คำถามเกี่ยวกับยา</h2>
        <textarea id="question" placeholder="เช่น: paracetamol รับประทานได้บ่อยแค่ไหน? หรือพิมพ์ข้อความบนฉลากที่อ่านได้"></textarea>
        <div class="row" style="margin-top:.6rem">
          <button class="btn" id="clearText" type="button">ล้างข้อความ</button>
        </div>
      </article>
    </section>

    <section style="margin-top: .8rem">
      <div class="row">
        <button class="btn primary" id="btnProcess">ประมวลผล</button>
        <button class="btn" id="btnReset" type="button">รีเซ็ตทั้งหมด</button>
      </div>
      <p id="status" class="status" role="status" aria-live="polite"></p>
    </section>

    <!-- โซนผลลัพธ์ (ข้อความเท่านั้น) -->
    <section id="result" aria-live="polite" aria-busy="false" hidden>
      <div class="result-wrap">
        <div class="result-head">
          <strong>ผลลัพธ์</strong>
          <div class="row">
            <button class="btn" id="copyText" type="button">คัดลอกข้อความ</button>
          </div>
        </div>
        <div class="result-body">
          <div id="resultText" class="result-text"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    'use strict';
    const $ = (s, p=document) => p.querySelector(s);

    const ACCEPT = ['image/png','image/jpeg'];
    const MAX_SIZE = 10 * 1024 * 1024; // 10MB

    function setBusy(el, busy=true){ el?.setAttribute('aria-busy', String(busy)); }

    function showStatus(msg, kind='info'){
      const el = $('#status');
      el.innerHTML = kind === 'loading' ? `<span class="loading"><span class="spinner"></span>${msg}</span>` : msg;
    }

    function setResultText(text){
      const box = $('#result');
      const out = $('#resultText');
      out.textContent = text || '';
      box.hidden = !text;
    }

    // ตรวจไฟล์
    function validateFile(file){
      if(!file) return { ok:true };
      if(!ACCEPT.includes(file.type)) return { ok:false, reason:'รองรับเฉพาะไฟล์ PNG หรือ JPG' };
      if(file.size > MAX_SIZE) return { ok:false, reason:'ไฟล์ใหญ่เกิน 10MB' };
      return { ok:true };
    }

    // อ่านไฟล์เป็น DataURL (ถ้าต้องส่งไป API ให้ใช้ FormData แทน)
    function readAsDataURL(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function processInput(){
      // เก็บค่า
      const text = $('#question').value.trim();
      const fileInput = $('#file');
      const file = fileInput.files?.[0] || null;

      if(!text && !file){
        showStatus('โปรดป้อนข้อความหรือเลือกรูปอย่างน้อยหนึ่งอย่าง');
        return;
      }

      // ตรวจไฟล์
      const v = validateFile(file);
      if(!v.ok){ showStatus(v.reason); return; }

      showStatus('กำลังประมวลผล…', 'loading');
      setBusy($('#result'), true);
      setResultText('');

      try{
        // ===== ตัวอย่างจำลองงานประมวลผล =====
        // แทนที่ส่วนนี้ด้วยการเรียก API จริงของคุณ เช่น:
        // const fd = new FormData(); fd.append('text', text); if(file) fd.append('image', file);
        // const res = await fetch('/api/mediscan', { method:'POST', body: fd });
        // const outText = await res.text(); // ให้ API ส่งกลับเป็นข้อความล้วน
        // setResultText(outText);

        // เดโม: ถ้าอัปโหลดรูป จะอ่าน dataURL เพื่อจำลองว่าทำ OCR ได้บางอย่าง
        let imgNote = '';
        if(file){
          await readAsDataURL(file); // ไม่ได้ใช้โชว์ แต่สมมุติว่า OCR แล้ว
          imgNote = `\n[ภาพ]: ตรวจพบรูปประเภท ${file.type === 'image/png' ? 'PNG' : 'JPG'} ขนาด ${(file.size/1024).toFixed(1)} KB`;
        }
        const base = text ? `ข้อความของคุณ: \n"${text}"` : 'ไม่มีข้อความ (ใช้รูปอย่างเดียว)';
        const summary = '\n\nสรุปผล (เดโม): ข้อมูลถูกส่งเข้ากระบวนการตรวจชื่อสามัญยา/ขนาดยา/คำเตือน แล้วจัดเรียงเป็นคำอธิบายที่อ่านง่าย';

        const out = `${base}${imgNote}${summary}`;
        setResultText(out);
        showStatus('เสร็จสิ้น ✔');
      }catch(err){
        console.error(err);
        showStatus('เกิดข้อผิดพลาดในการประมวลผล');
        setResultText(`เกิดข้อผิดพลาด: ${String(err?.message||err)}`);
      }finally{
        setBusy($('#result'), false);
      }
    }

    function setupDrop(){
      const dz = $('#drop');
      const fi = $('#file');
      const hint = $('#fileHint');

      ['dragenter','dragover'].forEach(ev=>{
        dz.addEventListener(ev, e=>{ e.preventDefault(); dz.classList.add('drag'); });
      });
      ;['dragleave','drop'].forEach(ev=>{
        dz.addEventListener(ev, e=>{ e.preventDefault(); dz.classList.remove('drag'); });
      });
      dz.addEventListener('drop', e => {
        const f = e.dataTransfer.files?.[0];
        if(f){
          const v = validateFile(f);
          if(!v.ok){ showStatus(v.reason); return; }
          const dt = new DataTransfer(); dt.items.add(f); fi.files = dt.files;
          hint.textContent = `เลือกไฟล์: ${f.name}`;
        }
      });
      fi.addEventListener('change', ()=>{
        const f = fi.files?.[0];
        hint.textContent = f ? `เลือกไฟล์: ${f.name}` : 'ยังไม่ได้เลือกไฟล์';
      });
      $('#clearFile').addEventListener('click', ()=>{ fi.value=''; hint.textContent='ยังไม่ได้เลือกไฟล์'; });
    }

    function setup(){
      $('#btnProcess').addEventListener('click', processInput);
      $('#btnReset').addEventListener('click', ()=>{
        $('#question').value = '';
        $('#file').value = '';
        $('#fileHint').textContent = 'ยังไม่ได้เลือกไฟล์';
        setResultText('');
        showStatus('');
      });
      $('#clearText').addEventListener('click', ()=>{ $('#question').value = ''; });
      $('#copyText').addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText($('#resultText').textContent || '');
          showStatus('คัดลอกผลลัพธ์แล้ว');
        }catch{ showStatus('คัดลอกไม่สำเร็จ'); }
      });

      setupDrop();
    }

    document.addEventListener('DOMContentLoaded', setup);
  </script>
</body>
</html>
